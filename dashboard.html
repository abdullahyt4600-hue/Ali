<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dashboard - TryHackingMe</title>
<style>
body{margin:0;font-family:'Orbitron',sans-serif;background:#121212;color:#fff;display:flex;flex-direction:row;}
.sidebar{width:250px;background:#1e1e1e;height:100vh;position:fixed;overflow-y:auto;padding-top:20px;}
.sidebar h2{text-align:center;color:#ce93d8;margin-bottom:20px;}
.sidebar a{display:block;padding:12px 20px;color:#fff;text-decoration:none;margin:5px 0;border-radius:5px;transition:0.3s;cursor:pointer;}
.sidebar a:hover{background:#6a1b9a;}
.main{margin-left:250px;padding:20px;width:100%;}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
header h1{color:#ce93d8;}
button{padding:10px 20px;background:#8e24aa;color:#fff;border:none;border-radius:5px;cursor:pointer;margin-bottom:20px;}
button:hover{background:#6a1b9a;}
video{width:100%;max-width:800px;border-radius:10px;margin-top:10px;}
.profile{margin-top:20px;background:#1e1e1e;padding:20px;border-radius:10px;}
.profile h3{margin-top:0;}
.profile input{width:100%;padding:10px;margin:5px 0;border:none;border-radius:5px;background:#2b2b2b;color:#fff;}
@media(max-width:768px){.sidebar{width:100%;height:auto;position:relative}.main{margin-left:0;}}
</style>
</head>
<body>

<div class="sidebar">
  <h2>TryHackingMe</h2>
  <a onclick="loadContent('wifi')">WiFi Hacking</a>
  <a onclick="loadContent('web')">Web Hacking</a>
  <a onclick="loadContent('social')">Social Engineering</a>
  <a onclick="loadProfile()">My Profile</a>
  <a onclick="logout()">Logout</a>
</div>

<div class="main" id="mainContent">
  <header>
    <h1>Welcome to Dashboard</h1>
  </header>
  <div id="dashboardHome">
    <p>Select a challenge from the sidebar to start learning.</p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAmSC92mozosP8JdQGOzF7KE9wCa-h4b_E",
  authDomain: "authdomain-b606b.firebaseapp.com",
  projectId: "authdomain-b606b",
  storageBucket: "authdomain-b606b.appspot.com",
  messagingSenderId: "374508656476",
  appId: "1:374508656476:web:1a1affe311734602bc5399"
};
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="index.html";
  else db.collection('users').doc(user.uid).update({
    lastOnline: firebase.firestore.FieldValue.serverTimestamp()
  });
});

function logout(){ auth.signOut().then(()=> window.location.href="index.html"); }

function loadContent(type){
  const main = document.getElementById('mainContent');
  let videoSrc="", title="";
  if(type==='wifi'){ 
    videoSrc="https://drive.google.com/uc?export=download&id=16PpL6zUBwytc9fnNouqncArauW10icuH";
    title="WiFi Hacking Challenge";
  } else if(type==='web'){ 
    videoSrc="https://drive.google.com/uc?export=download&id=WEB_FILE_ID"; 
    title="Web Hacking Challenge";
  } else if(type==='social'){ 
    videoSrc="https://drive.google.com/uc?export=download&id=SOCIAL_FILE_ID"; 
    title="Social Engineering Challenge";
  }
  main.innerHTML = `
    <header><h1>${title}</h1></header>
    <button onclick="backToHome()">â¬… Back</button>
    <video controls autoplay>
      <source src="${videoSrc}" type="video/mp4"/>
    </video>
  `;
}

function backToHome(){
  const main = document.getElementById('mainContent');
  main.innerHTML = `
    <header><h1>Welcome to Dashboard</h1></header>
    <div id="dashboardHome">
      <p>Select a challenge from the sidebar to start learning.</p>
    </div>
  `;
}

function loadProfile(){
  const main = document.getElementById('mainContent');
  const user = auth.currentUser;
  db.collection('users').doc(user.uid).get().then(doc=>{
    const data = doc.data();
    main.innerHTML=`<header><h1>My Profile</h1></header>
      <div class="profile">
        <h3>Email: ${data.email}</h3>
        <h3>Change Password</h3>
        <input type="password" id="currentPass" placeholder="Current Password"/>
        <input type="password" id="newPass" placeholder="New Password"/>
        <button onclick="changePassword()">Update Password</button>
        <p id="passMsg" style="color:red;"></p>
      </div>`;
  });
}

function changePassword(){
  const user = auth.currentUser;
  const currentPass = document.getElementById('currentPass').value;
  const newPass = document.getElementById('newPass').value;
  const msg = document.getElementById('passMsg');
  if(!currentPass || !newPass){ msg.textContent="Fill both fields!"; return; }

  const cred = firebase.auth.EmailAuthProvider.credential(user.email, currentPass);
  user.reauthenticateWithCredential(cred)
    .then(()=> user.updatePassword(newPass).then(()=> msg.textContent="Password updated!"))
    .catch(err=> msg.textContent=err.message);
}
</script>
</body>
</html>
